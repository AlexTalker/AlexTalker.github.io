---
layout: post
title: 'Systemd и /etc/fstab: device-timeout'
description: или история о том, чем бывает плохо удалять пароль root.
date: 2016-02-28 22:42:00 +0300
comments: true
tags: notes systemd ru
---
# Предисловие

Как показывает опыт, опытный пользователь отличается от новичка тем, что у него есть с чего загрузиться и починить сломанную систему. По возможности, без переустановки ☺. В моём случае для таких целей служит CD c [SystemRescueCd](http://www.system-rescue-cd.org/SystemRescueCd_Homepage), небольшим, но удобными дистрибутивом на базе **Gentoo**, предназначенном специально для этих целей.

К сожалению, даже опытные пользователи™ могут страдать ленью, когда не надо. Например, полениться перезагрузить ПК после обновления и отправить его в сон. Как он потом выключился, не знаю, но в итоге при загрузке **Systemd** пытался подключить `/home` раздел, но когда это у него не получалось примерно в течении минуты, он сдавался и предлагал ввести...пароль `root` для входа в режим восстановления. Первой проблемой стало то, что черезмерная параноя без повода склонила меня его стереть и всегда использовать `sudo` как способ получения его прав. Но, увы, похоже, авторы **Systemd** имеют несколько менее параноидальное мировоззрение ☺.

# Суть

При загрузке, **Systemd** строит на базе `/etc/fstab/` [юниты подключения(`.mount`)](https://www.freedesktop.org/software/systemd/man/systemd.mount.html#fstab). По-умолчанию, все разделы, указанные в `fstab` считаются *критическими*, то есть без них нельзя загрузить систему в так называемом "нормальном режиме". Сами же юниты подключения сначала запускают `fsck`, утилиту для проверки целостности раздела и ФС на нём. Только после этого происходит подключение.

По-умолчанию, время ожидания готовности подключаемого раздела ограничено **90** секундами. Если по их истечению, юнит подключения не будет успешно активирован, это будет считаться ошибкой подключения и, в случае с критическими, система не сможет нормально загрузиться.

Как показал опыт, время полной проверки случайно поврежденного раздела(**300** гигабайт) составило около **4** минут.

Поэтому ленивым решением стало изменение времени ожидания(*device-timeout*) через опции записи раздела в `fstab`. В документации сказано, что указав [x-systemd.device-timeout](https://www.freedesktop.org/software/systemd/man/systemd.mount.html#x-systemd.device-timeout=) позволяет изменить значение времени ожидания. К сожалению, проверить, работоспособность способа через `systemctl show` не получилось. Но судя по [Arch Wiki](https://wiki.archlinux.org/index.php/Fstab#External_devices), это то, что нужно.

Посему, выбирайте оптимальное значение этой опции для разделов, ставьте пароли на `root`, перезагружайтесь после обновлений и не совершайте подобных ошибок ☺. Удачи.
